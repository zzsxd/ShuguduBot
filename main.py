import time
import telebot
import os
import re
import json
import threading
import platform
from telebot import types
from threading import Lock
from config_parser import ConfigParser
from frontend import Bot_inline_btns
from backend import DbAct
from db import DB

config_name = 'secrets.json'


def main():
    @bot.message_handler(commands=['start', 'admin', 'support'])
    def start(message):
        command = message.text.replace('/', '')
        user_id = message.from_user.id
        buttons = Bot_inline_btns()
        if command == 'start':
            db_actions.set_user_system_key(user_id, "index", None)
            db_actions.add_user(user_id, message.from_user.first_name, message.from_user.last_name,
                        f'@{message.from_user.username}', None)
            bot.send_message(user_id, 'üíú –ü—Ä–∏–≤–µ—Ç!\n' \
            '–Ø ‚Äî –±–æ—Ç ShuGuDu. –ó–¥–µ—Å—å —Ç—ã –ø–æ–ª—É—á–∏—à—å –≥–∞–π–¥:\n' \
            '¬´–¢–û–ü 4 –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–∞–∫–ª–µ–π–∫–µ –ø—É—á–∫–æ–≤ ‚Äî –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å¬ª\n\n' \
            '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≥–∞–π–¥:\n' \
            '1Ô∏è‚É£ –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—à Telegram –∫–∞–Ω–∞–ª\n' \
            '2Ô∏è‚É£ –ü–æ–¥–µ–ª–∏—Å—å –Ω–æ–º–µ—Ä–æ–º ‚Äî —Ç–∞–∫ —è –±—É–¥—É –∑–Ω–∞—Ç—å, –∫—É–¥–∞ –ø—Ä–∏—Å–ª–∞—Ç—å —Ç–≤–æ–π –≥–∞–π–¥üíú',
            parse_mode='HTML', reply_markup=buttons.start_buttons())
        elif command == 'admin':
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
            if db_actions.user_is_admin(user_id) or user_id in config.get_config()['admins']:
                # –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
                if not db_actions.user_is_existed(user_id):
                    db_actions.add_user(user_id, message.from_user.first_name, message.from_user.last_name,
                                        f'@{message.from_user.username}', None)
                bot.send_message(user_id, "<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª—å!</b>"
                                 "\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –Ω–∏–∂–µ!", reply_markup=buttons.admin_buttons(), parse_mode='HTML')
            else:
                bot.send_message(user_id, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.")
        
        elif command == 'support':
            bot.send_message(user_id, "–í—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ShuGuDu –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç—É –Ω–∏–∂–µ –∏–ª–∏ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ WhatsApp! üíú", reply_markup=buttons.support_buttons())
            bot.send_contact(user_id, phone_number="+79931955487", first_name="ShuGuDu –ü–æ–¥–¥–µ—Ä–∂–∫–∞")

    @bot.message_handler(content_types=['text', 'photo', 'video', 'contact'])
    def text_message(message):
        user_id = message.chat.id
        chat_id = "@ShuGuDuLashes"
        user_input = message.text
        buttons = Bot_inline_btns()
        # –ë–ª–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞—Å—Å—ã–ª–∫–∞)
        if db_actions.user_is_existed(user_id) and (db_actions.user_is_admin(user_id) or user_id in config.get_config()['admins']):
            admin_action = db_actions.get_user_system_key(user_id, "admin_action")
            if admin_action == "broadcast_wait_content" and message.content_type in ['text', 'photo', 'video']:
                # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ (—Ç–æ–ª—å–∫–æ —Å username)
                recipients = db_actions.get_all_users_with_username()
                total = len(recipients)
                sent_ok = 0
                if total == 0:
                    db_actions.set_user_system_key(user_id, "admin_action", None)
                    bot.send_message(user_id, "–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞: –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å username –≤ –±–∞–∑–µ.")
                    return
                # –†–∞—Å—Å—ã–ª–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                if message.photo:
                    # –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Ñ–æ—Ç–æ (–Ω–∞–∏–±–æ–ª—å—à–µ–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É)
                    photo = message.photo[-1].file_id
                    caption = message.caption if message.caption else None
                    for uid in recipients:
                        try:
                            bot.send_photo(uid, photo, caption=caption)
                            sent_ok += 1
                        except Exception:
                            continue
                elif message.video:
                    video = message.video.file_id
                    caption = message.caption if message.caption else None
                    for uid in recipients:
                        try:
                            bot.send_video(uid, video, caption=caption)
                            sent_ok += 1
                        except Exception:
                            continue
                elif message.text:
                    for uid in recipients:
                        try:
                            bot.send_message(uid, message.text)
                            sent_ok += 1
                        except Exception:
                            continue
                # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
                db_actions.set_user_system_key(user_id, "admin_action", None)
                bot.send_message(
                    user_id,
                    f"–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.\n–£—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: {sent_ok} –∏–∑ {total} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."
                )
                return

        if db_actions.user_is_existed(user_id):
            if message.contact:
                db_actions.set_user_phone(user_id, message.contact.phone_number)
                bot.send_message(user_id, f"–°–ø–∞—Å–∏–±–æ, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏–Ω—è—Ç!", reply_markup=types.ReplyKeyboardRemove())
                member = bot.get_chat_member(chat_id, user_id)
                if member.status in ['member']:
                    bot.send_message(user_id, "üíú –°–ø–∞—Å–∏–±–æ! –¢—ã –≤ –∫–æ–º–∞–Ω–¥–µ ShuGuDu üí´\n"
                    "–õ–æ–≤–∏ —Ç–≤–æ–π –≥–∞–π–¥ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∫–ª–µ–∏—à—å –ø—É—á–∫–∏!")
                    bot.send_message(user_id, "ShuGuDu ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–π –∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∑–≥–ª—è–¥ –≤—Å–µ–≥–æ –∑–∞ 5 —Å–µ–∫—É–Ω–¥!\n"
                    "–ù–æ –¥–∞–∂–µ —Å–∞–º—ã–µ —É–¥–æ–±–Ω—ã–µ –ø—É—á–∫–∏ –≤–∞–∂–Ω–æ –∫–ª–µ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ.\n\n"
                    "–õ–æ–≤–∏ 3 —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ (–∏ 1 —Å–µ–∫—Ä–µ—Ç –¥–ª—è –∑–∏–º—ã), —á—Ç–æ–±—ã —Ç–≤–æ–∏ –ø—É—á–∫–∏ –≤—Å–µ–≥–¥–∞ –¥–µ—Ä–∂–∞–ª–∏—Å—å –∏–¥–µ–∞–ª—å–Ω–æ!")
                    bot.send_message(user_id, "1. –û—à–∏–±–∫–∞: –∫–ª–µ–∏—à—å –ø—É—á–æ–∫ –Ω–∞ –∫–æ–∂—É, –∞ –Ω–µ –Ω–∞ —Ä–µ—Å–Ω–∏—Ü—ã\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –ü—É—á–æ–∫ –ø–ª–æ—Ö–æ –¥–µ—Ä–∂–∏—Ç—Å—è, –∫–ª–µ–π –±—ã—Å—Ç—Ä–µ–µ –æ—Ç—Ö–æ–¥–∏—Ç, –∏ –ø—É—á–∫–∏ –º–æ–≥—É—Ç —Å–ø–æ–ª–∑–∞—Ç—å\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ü—Ä–∏–∫–ª–µ–∏–≤–∞–π –ø—É—á–æ–∫ –≤–ø—Ä–∏—Ç—ã–∫ –∫ –ª–∏–Ω–∏–∏ —Ä–æ—Å—Ç–∞ —Å–≤–æ–∏—Ö —Ä–µ—Å–Ω–∏—Ü, –∞ –Ω–µ –Ω–∞ –∫–æ–∂—É –≤–µ–∫–∞. –¢–∞–∫ –æ–Ω –¥–µ—Ä–∂–∏—Ç—Å—è –∫—Ä–µ–ø–∫–æ –∏ –≤—ã–≥–ª—è–¥–∏—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.")
                    bot.send_message(user_id, "2. –û—à–∏–±–∫–∞: –Ω–∞–Ω–æ—Å–∏—à—å –∫—Ä–µ–º –∏–ª–∏ –º–∞—Å–ª–æ –ø–µ—Ä–µ–¥ –Ω–∞–∫–ª–µ–π–∫–æ–π\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –û—Å—Ç–∞—Ç–∫–∏ –∫—Ä–µ–º–∞ –∏–ª–∏ –º–∞—Å–ª–∞ –Ω–∞ –≤–µ–∫–∞—Ö –º–µ—à–∞—é—Ç –∫–ª–µ—é ‚Äî –ø—É—á–æ–∫ –ø–ª–æ—Ö–æ –¥–µ—Ä–∂–∏—Ç—Å—è –∏ –º–æ–∂–µ—Ç –æ—Ç–ø–∞—Å—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä—É —á–∞—Å–æ–≤.\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ü–µ—Ä–µ–¥ –Ω–∞–∫–ª–µ–π–∫–æ–π –ø—Ä–æ—Ç—Ä–∏ –≤–µ–∫–æ –∏ —Ä–µ—Å–Ω–∏—Ü—ã —Å—É—Ö–∏–º –≤–∞—Ç–Ω—ã–º –¥–∏—Å–∫–æ–º –∏–ª–∏ –≤–∞—Ç–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π ‚Äî –∫–æ–∂–∞ –∏ —Ä–µ—Å–Ω–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å—Ç—ã–º–∏ –∏ –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ –∂–∏—Ä–∞.")
                    bot.send_message(user_id, "3. –û—à–∏–±–∫–∞: —Ç—Ä–æ–≥–∞–µ—à—å –ª–∏–ø–∫–∏–π —Å–ª–æ–π –ø—É—á–∫–∞\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –ï—Å–ª–∏ –±–µ—Ä—ë—à—å –ø—É—á–æ–∫ –ø–∞–ª—å—Ü–∞–º–∏ –∏–ª–∏ –ø–∏–Ω—Ü–µ—Ç–æ–º –∑–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ª–∏–ø–∫–∏–π —Å–ª–æ–π —Ç–µ—Ä—è–µ—Ç –∫–ª–µ—è—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ ‚Äî –ø—É—á–æ–∫ –¥–µ—Ä–∂–∏—Ç—Å—è —Ö—É–∂–µ.\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –±–µ—Ä–∏ –ø—É—á–æ–∫ –∑–∞ —Å–µ—Ä–µ–¥–∏–Ω—É –≤–æ–ª–æ—Å–∫–æ–≤, –Ω–µ –ø—Ä–∏–∫–∞—Å–∞—è—Å—å –∫ –æ—Å–Ω–æ–≤–∞–Ω–∏—é —Å –∫–ª–µ–µ–º. –¢–∞–∫ –æ–Ω –ø—Ä–∏–∫–ª–µ–∏—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ –∏ –ø—Ä–æ–¥–µ—Ä–∂–∏—Ç—Å—è –¥–æ–ª—å—à–µ.")
                    bot.send_message(user_id, "4. –û—à–∏–±–∫–∞: –∫–ª–µ–π –Ω–µ –ª—é–±–∏—Ç —Ö–æ–ª–æ–¥\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –í —Ö–æ–ª–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞ –∫–ª–µ–π –Ω–∞ –ø—É—á–∫–∞—Ö –º–æ–∂–µ—Ç –∑–∞—Ç–≤–µ—Ä–¥–µ—Ç—å –∏ –ø–ª–æ—Ö–æ —Å—Ü–µ–ø–ª—è—Ç—å—Å—è.\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ï—Å–ª–∏ –ø—É—á–∫–∏ –±—ã–ª–∏ –Ω–∞ —Ö–æ–ª–æ–¥–µ, –ø–æ–¥–µ—Ä–∂–∏ –∏—Ö –ø–∞—Ä—É –º–∏–Ω—É—Ç –≤ —Ç–µ–ø–ª–µ –∏–ª–∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø—Ä–æ–≥—Ä–µ–π —É–ø–∞–∫–æ–≤–∫—É —Ç—ë–ø–ª—ã–º —Ñ–µ–Ω–æ–º (–Ω–µ –≥–æ—Ä—è—á–∏–º!). –ö–ª–µ–π —Å—Ç–∞–Ω–µ—Ç —Å–Ω–æ–≤–∞ –ª–∏–ø–∫–∏–º –∏ –ø—Ä–∏–∫–ª–µ–∏—Ç—Å—è –∫–∞–∫ –Ω–∞–¥–æ!")
                    bot.send_message(user_id, "üéÄ –õ–∞–π—Ñ—Ö–∞–∫ ShuGuDu\n\n"
                    "–î–ª—è –º–æ–¥–Ω–æ–≥–æ ¬´–ª–∏—Å—å–µ–≥–æ¬ª –≤–∑–≥–ª—è–¥–∞ —Å—Ç–∞–≤—å –ø–∞—Ä—É –ø—É—á–∫–æ–≤ –±–ª–∏–∂–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É —É–≥–æ–ª–∫—É, —á—É—Ç—å –ø–æ–¥ –Ω–∞–∫–ª–æ–Ω–æ–º –∫ –≤–∏—Å–∫—É ‚Äî —Ç–∞–∫ –≥–ª–∞–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è.")
                    bot.send_message(user_id, "ShuGuDu ‚Äî —ç—Ç–æ –ª—ë–≥–∫–∏–µ –ø—É—á–∫–∏ –¥–∞–∂–µ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤.\n"
                    "–ö–ª–µ–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –∏ —Ç–≤–æ–π –≤–∑–≥–ª—è–¥ –≤—Å–µ–≥–¥–∞ –∏–¥–µ–∞–ª–µ–Ω –∑–∞ 5 —Å–µ–∫—É–Ω–¥!\n\n"
                    "–£–ª—ã–±–∞–π—Å—è –∏ —Å–∏—è–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚ú®\n\n"
                    "–ï—Å–ª–∏ –≤–¥—Ä—É–≥ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å ‚Äî –Ω–∞–ø–∏—à–∏ /support - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ üíú")
                else:
                    bot.send_message(user_id, "‚ùå –ü–æ—Ö–æ–∂–µ, —Ç—ã –µ—â—ë –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª.", reply_markup=buttons.tg_channel())
                    bot.send_message(user_id, "–ü–æ–¥–ø–∏—à–∏—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞ —Å–≤–æ–∏–º –≥–∞–π–¥–æ–º üíú", reply_markup=buttons.im_subscribe())

            elif user_input == "üí´ –Ø –ø–æ–¥–ø–∏—Å–∞–Ω!":
                member = bot.get_chat_member(chat_id, user_id)
                if member.status in ['member']:
                    bot.send_message(user_id, "üíú –°–ø–∞—Å–∏–±–æ! –¢—ã –≤ –∫–æ–º–∞–Ω–¥–µ ShuGuDu üí´\n"
                    "–õ–æ–≤–∏ —Ç–≤–æ–π –≥–∞–π–¥ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∫–ª–µ–∏—à—å –ø—É—á–∫–∏!", reply_markup=types.ReplyKeyboardRemove())
                    bot.send_message(user_id, "ShuGuDu ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–π –∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∑–≥–ª—è–¥ –≤—Å–µ–≥–æ –∑–∞ 5 —Å–µ–∫—É–Ω–¥!\n"
                    "–ù–æ –¥–∞–∂–µ —Å–∞–º—ã–µ —É–¥–æ–±–Ω—ã–µ –ø—É—á–∫–∏ –≤–∞–∂–Ω–æ –∫–ª–µ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ.\n\n"
                    "–õ–æ–≤–∏ 3 —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ (–∏ 1 —Å–µ–∫—Ä–µ—Ç –¥–ª—è –∑–∏–º—ã), —á—Ç–æ–±—ã —Ç–≤–æ–∏ –ø—É—á–∫–∏ –≤—Å–µ–≥–¥–∞ –¥–µ—Ä–∂–∞–ª–∏—Å—å –∏–¥–µ–∞–ª—å–Ω–æ!")
                    bot.send_message(user_id, "1. –û—à–∏–±–∫–∞: –∫–ª–µ–∏—à—å –ø—É—á–æ–∫ –Ω–∞ –∫–æ–∂—É, –∞ –Ω–µ –Ω–∞ —Ä–µ—Å–Ω–∏—Ü—ã\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –ü—É—á–æ–∫ –ø–ª–æ—Ö–æ –¥–µ—Ä–∂–∏—Ç—Å—è, –∫–ª–µ–π –±—ã—Å—Ç—Ä–µ–µ –æ—Ç—Ö–æ–¥–∏—Ç, –∏ –ø—É—á–∫–∏ –º–æ–≥—É—Ç —Å–ø–æ–ª–∑–∞—Ç—å\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ü—Ä–∏–∫–ª–µ–∏–≤–∞–π –ø—É—á–æ–∫ –≤–ø—Ä–∏—Ç—ã–∫ –∫ –ª–∏–Ω–∏–∏ —Ä–æ—Å—Ç–∞ —Å–≤–æ–∏—Ö —Ä–µ—Å–Ω–∏—Ü, –∞ –Ω–µ –Ω–∞ –∫–æ–∂—É –≤–µ–∫–∞. –¢–∞–∫ –æ–Ω –¥–µ—Ä–∂–∏—Ç—Å—è –∫—Ä–µ–ø–∫–æ –∏ –≤—ã–≥–ª—è–¥–∏—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.")
                    bot.send_message(user_id, "2. –û—à–∏–±–∫–∞: –Ω–∞–Ω–æ—Å–∏—à—å –∫—Ä–µ–º –∏–ª–∏ –º–∞—Å–ª–æ –ø–µ—Ä–µ–¥ –Ω–∞–∫–ª–µ–π–∫–æ–π\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –û—Å—Ç–∞—Ç–∫–∏ –∫—Ä–µ–º–∞ –∏–ª–∏ –º–∞—Å–ª–∞ –Ω–∞ –≤–µ–∫–∞—Ö –º–µ—à–∞—é—Ç –∫–ª–µ—é ‚Äî –ø—É—á–æ–∫ –ø–ª–æ—Ö–æ –¥–µ—Ä–∂–∏—Ç—Å—è –∏ –º–æ–∂–µ—Ç –æ—Ç–ø–∞—Å—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä—É —á–∞—Å–æ–≤.\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ü–µ—Ä–µ–¥ –Ω–∞–∫–ª–µ–π–∫–æ–π –ø—Ä–æ—Ç—Ä–∏ –≤–µ–∫–æ –∏ —Ä–µ—Å–Ω–∏—Ü—ã —Å—É—Ö–∏–º –≤–∞—Ç–Ω—ã–º –¥–∏—Å–∫–æ–º –∏–ª–∏ –≤–∞—Ç–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π ‚Äî –∫–æ–∂–∞ –∏ —Ä–µ—Å–Ω–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å—Ç—ã–º–∏ –∏ –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ –∂–∏—Ä–∞.")
                    bot.send_message(user_id, "3. –û—à–∏–±–∫–∞: —Ç—Ä–æ–≥–∞–µ—à—å –ª–∏–ø–∫–∏–π —Å–ª–æ–π –ø—É—á–∫–∞\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –ï—Å–ª–∏ –±–µ—Ä—ë—à—å –ø—É—á–æ–∫ –ø–∞–ª—å—Ü–∞–º–∏ –∏–ª–∏ –ø–∏–Ω—Ü–µ—Ç–æ–º –∑–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ª–∏–ø–∫–∏–π —Å–ª–æ–π —Ç–µ—Ä—è–µ—Ç –∫–ª–µ—è—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ ‚Äî –ø—É—á–æ–∫ –¥–µ—Ä–∂–∏—Ç—Å—è —Ö—É–∂–µ.\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –±–µ—Ä–∏ –ø—É—á–æ–∫ –∑–∞ —Å–µ—Ä–µ–¥–∏–Ω—É –≤–æ–ª–æ—Å–∫–æ–≤, –Ω–µ –ø—Ä–∏–∫–∞—Å–∞—è—Å—å –∫ –æ—Å–Ω–æ–≤–∞–Ω–∏—é —Å –∫–ª–µ–µ–º. –¢–∞–∫ –æ–Ω –ø—Ä–∏–∫–ª–µ–∏—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ –∏ –ø—Ä–æ–¥–µ—Ä–∂–∏—Ç—Å—è –¥–æ–ª—å—à–µ.")
                    bot.send_message(user_id, "4. –û—à–∏–±–∫–∞: –∫–ª–µ–π –Ω–µ –ª—é–±–∏—Ç —Ö–æ–ª–æ–¥\n\n"
                    "‚ùå –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç: –í —Ö–æ–ª–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞ –∫–ª–µ–π –Ω–∞ –ø—É—á–∫–∞—Ö –º–æ–∂–µ—Ç –∑–∞—Ç–≤–µ—Ä–¥–µ—Ç—å –∏ –ø–ª–æ—Ö–æ —Å—Ü–µ–ø–ª—è—Ç—å—Å—è.\n"
                    "‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ï—Å–ª–∏ –ø—É—á–∫–∏ –±—ã–ª–∏ –Ω–∞ —Ö–æ–ª–æ–¥–µ, –ø–æ–¥–µ—Ä–∂–∏ –∏—Ö –ø–∞—Ä—É –º–∏–Ω—É—Ç –≤ —Ç–µ–ø–ª–µ –∏–ª–∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø—Ä–æ–≥—Ä–µ–π —É–ø–∞–∫–æ–≤–∫—É —Ç—ë–ø–ª—ã–º —Ñ–µ–Ω–æ–º (–Ω–µ –≥–æ—Ä—è—á–∏–º!). –ö–ª–µ–π —Å—Ç–∞–Ω–µ—Ç —Å–Ω–æ–≤–∞ –ª–∏–ø–∫–∏–º –∏ –ø—Ä–∏–∫–ª–µ–∏—Ç—Å—è –∫–∞–∫ –Ω–∞–¥–æ!")
                    bot.send_message(user_id, "üéÄ –õ–∞–π—Ñ—Ö–∞–∫ ShuGuDu\n\n"
                    "–î–ª—è –º–æ–¥–Ω–æ–≥–æ ¬´–ª–∏—Å—å–µ–≥–æ¬ª –≤–∑–≥–ª—è–¥–∞ —Å—Ç–∞–≤—å –ø–∞—Ä—É –ø—É—á–∫–æ–≤ –±–ª–∏–∂–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É —É–≥–æ–ª–∫—É, —á—É—Ç—å –ø–æ–¥ –Ω–∞–∫–ª–æ–Ω–æ–º –∫ –≤–∏—Å–∫—É ‚Äî —Ç–∞–∫ –≥–ª–∞–∑ –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è.")
                    bot.send_message(user_id, "ShuGuDu ‚Äî —ç—Ç–æ –ª—ë–≥–∫–∏–µ –ø—É—á–∫–∏ –¥–∞–∂–µ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤.\n"
                    "–ö–ª–µ–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –∏ —Ç–≤–æ–π –≤–∑–≥–ª—è–¥ –≤—Å–µ–≥–¥–∞ –∏–¥–µ–∞–ª–µ–Ω –∑–∞ 5 —Å–µ–∫—É–Ω–¥!\n\n"
                    "–£–ª—ã–±–∞–π—Å—è –∏ —Å–∏—è–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚ú®\n\n"
                    "–ï—Å–ª–∏ –≤–¥—Ä—É–≥ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å ‚Äî –Ω–∞–ø–∏—à–∏ /support - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ üíú")
                else:
                    bot.send_message(user_id, "‚ùå –ü–æ—Ö–æ–∂–µ, —Ç—ã –µ—â—ë –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª.", reply_markup=buttons.tg_channel())
                    bot.send_message(user_id, "–ü–æ–¥–ø–∏—à–∏—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞ —Å–≤–æ–∏–º –≥–∞–π–¥–æ–º üíú", reply_markup=buttons.im_subscribe())
                


    @bot.callback_query_handler(func=lambda call: True)
    def callback(call):
        user_id = call.message.chat.id
        buttons = Bot_inline_btns()
        if db_actions.user_is_existed(user_id):
            if db_actions.user_is_admin(user_id):
                if call.data == "export_users":
                    db_actions.db_export_xlsx()
                    bot.send_document(user_id, open(config.get_config()['xlsx_path'], 'rb'))
                    os.remove(config.get_config()['xlsx_path'])
                elif call.data == "broadcast":
                    # –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
                    db_actions.set_user_system_key(user_id, "admin_action", "broadcast_wait_content")
                    bot.send_message(user_id, "üì¢ –†–µ–∂–∏–º —Ä–∞—Å—Å—ã–ª–∫–∏ –≤–∫–ª—é—á—ë–Ω.\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Ä–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.")
            if call.data == 'share_contact':
                bot.send_message(user_id, "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∞—à –Ω–æ–º–µ—Ä!", reply_markup=buttons.share_contact())
    

    bot.polling(none_stop=True)


if '__main__' == __name__:
    os_type = platform.system()
    work_dir = os.path.dirname(os.path.realpath(__file__))
    config = ConfigParser(f'{work_dir}/{config_name}', os_type)
    db = DB(config.get_config()['db_file_name'], Lock())
    db_actions = DbAct(db, config, config.get_config()['xlsx_path'])
    bot = telebot.TeleBot(config.get_config()['tg_api'])
    main()